---
title: "TER - Résultats - nback"
output:
  html_notebook:
    theme: default
    code_folding: hide
  pdf_document: default
---

```{r}

library(tidyverse)
library(ggpubr)
library(rstatix)
library(xtable)
library(wesanderson)

```


# N-Back


```{r}

nback <- read.csv2("data/nback.csv", sep = ",", fileEncoding="UTF-8-BOM")

nback$groupe <- as.factor(nback$groupe)
nback$subject_id <- as.factor(nback$subject_id)
nback$part <- factor(nback$part, levels = c("2_back_pre", "2_back_post"))
nback$id_2_back <- as.factor(nback$id_2_back)
nback$trial_id <- as.factor(nback$trial_id)

nback[is.na(nback)] <- 0

nback <- nback %>%
  filter(subject_id != 13) # trop de no-input

nback_summary <- nback %>%
  group_by(groupe, part) %>%
  summarize_if(is.numeric, mean)

nback_transc <- nback %>%
  filter(groupe == "transc")

nback_control <- nback %>%
  filter(groupe == "control")

nback_summary


```

## Temps de réponse

```{r}

nback_rt <- nback

nback_rt %>%
  group_by(groupe, part) %>%
  get_summary_stats(rt)

```

```{r}

out_rt <- boxplot.stats(nback_rt$rt)$out


nback_rt <- nback_rt %>%
  filter(!rt %in% out_rt)

ggboxplot(nback_rt, x = "groupe", y = "rt", fill = "part")


```

```{r}

rt_densit <- ggdensity(nback_rt, x = "rt", fill = "part", main = "Densité RT", facet.by = "groupe") 
rt_densit %>%
  ggexport(filename = "Plots/rt_densit.pdf")
rt_densit

```

```{r}

ggqqplot(nback_rt, x = "rt", facet.by = c("groupe", "part"))

```

### Shapiro

```{r}

nback_rt %>%
  group_by(groupe, part) %>%
  shapiro_test(rt)

```



```{r}

rt_means <- ggbarplot(nback_rt, x = "groupe", y = "rt", fill = "part", position = position_dodge(0.8), add = "mean_sd", xlab = "Groupe", ylab = "Temps de réponse") +
  scale_fill_discrete(name = "Moment", labels = c("Pré-test", "Post-test"))

rt_means %>%
  ggexport(filename = "Plots/rt_means.pdf")

rt_means

```




```{r}

rt_model <- lm(data = nback_rt, rt~part+groupe)
ggqqplot(residuals(rt_model), main = "Résidus - qqplot")

```

### Wilconxon

#### Effet du groupe

```{r}

rt_kruskal_g <- nback_rt %>%
  group_by(part) %>%
  wilcox_test(rt ~ groupe)

rt_kruskal_g

```


#### Effet post-test

```{r}

rt_kruskal_t <- nback %>%
  group_by(groupe) %>%
  wilcox_test(rt ~ part, paired = T)

rt_kruskal_t

```


## Performances


```{r}
nback_score <- nback %>%
  group_by(groupe, subject_id, part, id_2_back) %>%
  summarise_if(is.numeric, mean)

nback_score %>%
  group_by(groupe, part) %>%
  get_summary_stats(Score)
```

```{r}
ggboxplot(nback_score, x = "groupe", y = "Score", fill = "part")
```


```{r}
ggdensity(nback_score, x = "Score", fill = "part", main = "Densité Performances", facet.by = "groupe")
```

```{r}
ggqqplot(nback_score, x = "Score", facet.by = c("groupe", "part"))
```

### Shapiro

```{r}
nback_score %>%
  group_by(groupe, part) %>%
  shapiro_test(Score)
```


```{r}
perf <- ggbarplot(nback_score, x = "groupe", y = "Score", fill = "part", position = position_dodge(0.8), add = "mean_sd") +
  scale_fill_discrete(name = "Moment", labels = c("Pré-test", "Post-test"))

perf %>%
  ggexport(filename = "Plots/perf.pdf")

perf
```


```{r}
sc_model <- lm(data = nback_score, Score~part+groupe)
ggqqplot(residuals(sc_model), main = "Résidus - qqplot")
```


### Wilconxon

#### Effet du groupe

```{r}

sc_kruskal_g <- nback_score %>%
  group_by(part) %>%
  wilcox_test(Score ~ groupe)
sc_kruskal_g

```


#### Effet post-test

```{r}

sc_kruskal_t <- nback_score %>%
  group_by(groupe) %>%
  wilcox_test(Score ~ part, paired = T)
sc_kruskal_t

```



# Delta

```{r}

nback_delta <- nback_score %>% 
  group_by(groupe, subject_id, part) %>%
  summarise(Score = mean(Score), rt = mean(rt)) %>%
  pivot_wider(names_from = part, values_from = c(Score, rt)) %>%
  mutate(Score_delta = Score_2_back_pre - Score_2_back_post) %>%
  mutate(Score_delta = round(Score_delta, 4)) %>%
  mutate(rt_delta = rt_2_back_pre - rt_2_back_post) %>%
  mutate(rt_delta = round(rt_delta, 4))

nback_delta %>%
  group_by(groupe) %>%
  summarise_if(is.numeric, c(mean))

```























